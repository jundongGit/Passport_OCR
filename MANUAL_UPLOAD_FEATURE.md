# 销售手动上传护照功能说明

## 功能概述
销售人员现在可以在销售界面直接为游客上传护照照片，系统会自动使用AI进行护照信息识别。

## 使用场景
1. **现场办理**：游客到店办理时，销售人员可以现场拍照并上传护照
2. **远程协助**：游客无法自助上传时，可通过微信等方式发送照片给销售
3. **批量处理**：销售收集多个游客护照照片后批量上传处理

## 功能特性

### 1. 便捷的上传入口
- 在"我的游客历史"页面，每个未上传护照的游客都会显示"上传护照"按钮
- 点击按钮即可打开上传对话框

### 2. 拖拽式上传界面
- 支持点击选择文件或直接拖拽文件到上传区域
- 支持格式：JPG、JPEG、PNG
- 文件大小限制：10MB

### 3. AI自动识别
上传后系统会自动识别以下护照信息：
- ✅ 姓名（Full Name）
- ✅ 护照号码（Passport Number）
- ✅ 性别（Gender）
- ✅ 国籍（Nationality）
- ✅ 出生日期（Date of Birth）
- ✅ 出生地（Place of Birth）
- ✅ 签发日期（Issue Date）
- ✅ 有效期至（Expiry Date）

### 4. 实时反馈
- 上传过程显示进度提示
- 识别成功后立即显示识别结果
- 自动保存到数据库，无需手动确认

### 5. 双重上传方式
系统同时支持两种上传方式：
1. **销售手动上传**：销售在系统中直接上传（新增功能）
2. **游客自助上传**：游客通过上传链接自行上传（原有功能）

## 操作步骤

### 步骤1：找到游客
1. 登录销售账号
2. 进入"我的游客历史"页面
3. 找到需要上传护照的游客

### 步骤2：上传护照
1. 点击游客行的"上传护照"按钮
2. 在弹出的对话框中：
   - 点击上传区域选择文件，或
   - 直接拖拽护照图片到上传区域
3. 等待系统上传并识别（通常需要5-10秒）

### 步骤3：查看结果
1. 识别成功后会自动显示识别结果
2. 护照信息已自动保存到系统
3. 游客状态自动更新为"已验证"
4. "上传护照"按钮变为"查看护照"按钮

## 注意事项

### 照片要求
- ✅ 护照页面平整，避免褶皱
- ✅ 光线充足，避免反光
- ✅ 照片清晰，文字可见
- ✅ 完整拍摄护照信息页
- ❌ 避免手指遮挡
- ❌ 避免模糊不清
- ❌ 避免过度曝光或过暗

### 识别失败处理
如果AI识别失败：
1. 系统会提示"护照照片已上传，但自动识别失败，请手动填写信息"
2. 照片已保存，管理员可以在管理界面手动补充信息
3. 建议：重新拍摄更清晰的照片后再次上传

### 权限说明
- 销售人员可以为自己添加的游客上传护照
- 只能上传一次，如需更换请联系管理员删除后重新上传

## 技术架构

### 前端实现
- 使用 Ant Design Upload.Dragger 组件
- 拖拽上传、实时进度显示
- 文件类型和大小验证

### 后端API
```
POST /api/tourists/:id/update-passport
```
- 参数：multipart/form-data（passport字段）
- 认证：需要销售人员登录token
- 响应：识别结果JSON

### AI识别
- 使用 OpenAI GPT-4 Vision API
- 图片质量检查（分辨率、清晰度、尺寸）
- OCR文本提取和结构化数据解析

## 常见问题

**Q1：上传后多久能看到识别结果？**
A1：通常5-10秒，取决于网络速度和图片大小。

**Q2：识别错误怎么办？**
A2：联系管理员在管理界面修改护照信息。

**Q3：能否重新上传护照？**
A3：目前不支持覆盖，如需更换请联系管理员删除后重新上传。

**Q4：游客自己上传后，销售还能看到吗？**
A4：可以，销售可以查看所有自己添加的游客的护照照片。

**Q5：识别支持哪些国家的护照？**
A5：理论上支持所有国家护照，但识别准确率取决于护照格式的标准化程度。

## 未来优化计划
- [ ] 支持护照照片更换（覆盖上传）
- [ ] 批量上传多个游客护照
- [ ] 移动端优化（手机拍照直接上传）
- [ ] 识别结果人工审核和修改界面
- [ ] OCR识别准确率统计和改进
